# OpenClaw 多代理系统优化方案

> 制定日期：2026-02-21
> 制定人：研究员 (yanjiuyuan)
> 目标：为 OpenClaw 多代理系统制定可执行的优化计划

---

## 一、优先级排序

基于**价值产出比**和**实施难度**的综合评估：

| 优先级 | 优化项 | 理由 |
|--------|--------|------|
| **P0** | 创建 Agent 专属 SOUL.md (各一份) | 立即提升人格一致性，难度低、见效快 |
| **P1** | 编写 HUMAN-IN-LOOP.md 设计文档 | 明确人机协作边界，防止越权 |
| **P2** | 设计"顾问型"交互模式 | 扩展系统能力边界，提升复杂任务处理 |
| **P3** | 补充缺失的 IDENTITY.md | 完善其他3个 Agent 的身份定义 |

---

## 二、具体实施步骤

### P0: 创建 Agent 专属 SOUL.md

#### 2.1 为每个 Agent 创建 `SOUL-<agent>.md`

**目标**：为4个Agent各创建一份人格定义文件，补充通用 SOUL.md 的不足。

**文件结构**（每个Agent的SOUL文件）：

```markdown
# SOUL-<agent>.md - <Agent名称>的人格定义

## 核心角色
<一句话定义其存在意义>

## 性格特质
- <特质1>: <具体表现>
- <特质2>: <具体表现>

## 决策风格
<面对任务时的典型处理方式>

## 沟通偏好
- 说话风格：<如：简洁直接 / 书面正式 / 活泼俏皮>
- 汇报节奏：<如：完成后汇报 / 阶段性汇报 / 立即汇报>

## 禁忌/红线
- <如：不在未经允许时调用付费API>
- <如：不代替用户做 irreversible 决策>

## 与其他Agent的协作模式
- 包工头：...
- 程序员：...
- 作家：...
- 研究员：...
```

**实施步骤**：

1. **研究员 (yanjiuyuan)** - 已有基本 IDENTITY.md，升级为完整 SOUL
   - 补充：决策风格、协作模式、禁忌清单
   - 产出：`SOUL-yanjiuyuan.md`

2. **包工头 (baogongtou)** - 任务调度者
   - 重点：决策逻辑、任务分发风格、冲突仲裁方式
   - 产出：`SOUL-baogongtou.md`

3. **程序员 (chengxuyuan)** - 技术实现者
   - 重点：代码审美、调试风格、技术决策原则
   - 产出：`SOUL-chengxuyuan.md`

4. **作家 (zuojia)** - 内容创作者
   - 重点：文风偏好、内容审核标准、创意边界
   - 产出：`SOUL-zuojia.md`

**预期效果**：
- 每个 Agent 决策时有更清晰的性格参考
- 多 Agent 协作时减少风格冲突
- 新增 Agent 时有模板可循

---

### P1: 编写 HUMAN-IN-LOOP.md 设计文档

#### 2.2 明确"人类在环"机制

**目标**：用文档形式明确什么决策必须人类确认、什么可以自主处理。

**文件内容**：

```markdown
# HUMAN-IN-LOOP.md - 人类在环设计文档

## 设计原则

1. **安全优先** - 涉及资金、隐私、不可逆操作必须人类确认
2. **效率平衡** - 低风险、重复性决策可自动处理
3. **透明可追溯** - 自动决策需记录日志，人类可审查

## 决策分级

### 🔴 L0 - 必须人类授权（阻塞式）
- 发送外部消息（邮件、社交媒体推文）
- 资金操作（交易、支付、转账）
- 删除/修改用户数据
- 添加/移除系统权限

### 🟡 L1 - 建议人类确认（提示式）
- 发布公开内容（博客、文章）
- 修改配置文件
- 调用付费API
- 批量操作（>10条记录）

### 🟢 L2 - 可自主执行（直接执行）
- 信息检索和整理
- 内部数据计算
- 生成草稿（不直接发布）
- 定时检查（心跳任务）

## 确认模板

当需要人类确认时，使用以下格式：

```
🤔 需要确认：<动作描述>

选项：
1. [确认] <动作1>
2. [拒绝] <动作2>
3. [修改] <自定义>

请回复编号或具体指令
```

## 异常处理

- 人类超时（默认5分钟）：提示两次后暂停，等待下一步指令
- 人类拒绝：记录原因，释放资源，任务标记为"已取消"
- 无法联系人类：仅执行 L2 级操作，其他全部暂停

## 特殊场景

### 紧急模式（人类不可用）
- 定义触发条件（如连续3次联系失败）
- 允许执行的最小操作集
- 恢复人类控制后的报告机制
```

**预期效果**：
- Agent 行为有明确边界
- 减少"AI 擅自做主"的风险
- 人类对系统能力有清晰预期

---

### P2: 设计"顾问型"交互模式

#### 2.3 新增交互模式文档

**目标**：扩展系统能力，支持头脑风暴、方案评审等非任务型交互。

**文件内容**：

```markdown
# ADVISORY-MODE.md - 顾问型交互模式

## 模式说明

区别于"任务执行模式"（用户给任务 → Agent 完成），顾问模式是：
- **无明确任务** - 用户需要的是思考伙伴，不是执行者
- **协作式推理** - 双方共同推演，Agent 提供专业知识
- **产出多元化** - 可能是一系列选项、一个计划、或一个 TODO

## 场景分类

### 🧠 头脑风暴 (Brainstorm)
**特征**：用户有初步想法，需要更多可能性
**触发词**："、"、"有什么想法"、"帮我看看"

**Agent 行为**：
- 先理解用户已有思路
- 提出 3-5 个延伸方向
- 每个方向简要利弊分析
- 不做价值判断，鼓励创意

**输出格式**：
```
💡 几个方向供参考：

1. <方向A>
   - 优势：...
   - 风险：...
   
2. <方向B>
   - ...

3. <方向C>
   - ...

你想深入哪个？或者有其他想法？
```

### 📋 方案评审 (Review)
**特征**：用户已有方案，需要反馈
**触发词**："看看这个方案"、"评审"、"有什么问题"

**Agent 行为**：
- 先完整理解方案（可能需要提问澄清）
- 结构化反馈：优点 → 风险 → 建议
- 重大问题优先，轻微问题次要
- 用事实/数据支撑质疑

**输出格式**：
```
📋 评审意见：

✅ 优点：
- <优点1>
- <优点2>

⚠️ 风险：
- <风险1>（影响：<影响描述>）
- <风险2>

💡 建议：
- <建议1>
- <建议2>

总体评估：<优秀/可行/需修改/不建议>
```

### 🤔 决策咨询 (Decision)
**特征**：用户面临选择，需要建议
**触发词**："怎么选"、"帮我分析一下"、"给个建议"

**Agent 行为**：
- 列出决策关键维度
- 量化或对比各选项
- 给出基于信息的建议（而非替你决定）
- 明确说明"这是建议，最终决定权在你"

**输出格式**：
```
🎯 决策分析：

关键维度：
| 维度 | 选项A | 选项B | 权重 |
|------|-------|-------|------|
| 成本 | ...   | ...   | 高   |
| 风险 | ...   | ...   | 中   |
| ...  | ...   | ...   | ...  |

建议：<选项X>
理由：<核心原因>
提醒：<需要注意的变量>
```

### 📅 规划推演 (Planning)
**特征**：用户需要制定计划，但不确定是否合理
**触发词**："这样安排行吗"、"帮我看看计划"

**Agent 行为**：
- 理解计划目标和约束
- 模拟时间线，识别冲突/瓶颈
- 提出优化建议
- 不强制修改，只提供选项

## 模式切换

### 何时从顾问模式切回任务模式
- 用户明确说："那帮我做吧"
- 用户确认了方案，要求执行

### 如何识别用户意图
1. **关键词匹配**：检测触发词
2. **上下文判断**：无明确任务描述时进入顾问模式
3. **显式切换**：用户说"先讨论/先看看"（顾问），"好了开始做"（任务）

## 协作分工

| 场景 | 主要Agent | 辅助Agent |
|------|-----------|-----------|
| 头脑风暴 | 包工头 | 作家（创意）、研究员（调研） |
| 方案评审 | 包工头 | 程序员（技术可行性） |
| 决策咨询 | 包工头 | 研究员（信息支持） |
| 规划推演 | 包工头 | 程序员（时间估算） |

---

### P3: 补充缺失的 IDENTITY.md

#### 2.4 为其他 Agent 补充身份定义

**当前状态**：只有研究员 (yanjiuyuan) 有 IDENTITY.md

**需要补充**：

| Agent | 需补充内容 |
|-------|------------|
| baogongtou | 角色定义、性格、沟通规则、自我认知 |
| chengxuyuan | 角色定义、性格、技术栈偏好、交付标准 |
| zuojia | 角色定义、性格、文风偏好、内容边界 |

**文件模板**：

```markdown
# IDENTITY.md

- **角色**: <中文名> (<英文名>)
- **性格**: <核心性格描述>
- **沟通规则**: <接收任务/汇报/提问的规则>
- **交付标准**: <交付物的格式/质量要求>
- **禁忌**: <不做的事/不说的内容>
- **自我认知规则**: <如何回答"你是什么模型"这类问题>
```

---

## 三、预期效果

### 量化预期

| 优化项 | 预期效果 | 可观测指标 |
|--------|----------|------------|
| Agent 专属 SOUL | 决策一致性↑ | 多 Agent 协作时风格冲突减少 |
| HUMAN-IN-LOOP | 越权操作↓ | 需要确认的操作占比 >30% |
| 顾问模式 | 复杂任务处理能力↑ | 头脑风暴/评审场景用户满意度 |
| IDENTITY 补全 | Agent 可辨识性↑ | 各 Agent 身份定义完整性 100% |

### 质化预期

1. **更清晰的 Agent 边界** - 每个 Agent 知道自己"是谁"
2. **更安全的人机协作** - 人类始终掌握最终控制权
3. **更丰富的交互场景** - 系统不仅能执行任务，还能提供顾问服务
4. **更好的可维护性** - 新增 Agent 有模板可循

---

## 四、风险和注意事项

### 风险 1：文档过度复杂化
- **风险**：文件太多导致 Agent 无所适从
- **缓解**：控制总文件数，每个 Agent 核心文件 ≤3 个

### 风险 2：顾问模式占用过多资源
- **风险**：开放顾问模式后，Agent 花太多时间"讨论"而非"执行"
- **缓解**：限定单次顾问对话轮数（建议 ≤5 轮），超时提醒用户切换模式

### 风险 3：HUMAN-IN-LOOP 过于严格
- **风险**：每个操作都要确认，导致体验下降
- **缓解**：L1/L2 级默认自动执行，仅 L0 强制确认

### 风险 4：Agent 个性过度强化
- **风险**：Agent 太"有个性"导致难以协作
- **缓解**：SOUL 文件中明确"协作优先于个性"原则

### 注意事项

1. **保持向后兼容** - 现有 MEMORY.md、AGENTS.md 等文件继续有效
2. **渐进式实施** - 先做 P0，再做 P1，以此类推
3. **实际使用中迭代** - 文档不是一次性的，需要根据使用反馈调整
4. **同步到主分支** - 优化后的文件应及时同步到所有 Agent 的工作区

---

## 五、实施时间线

| 周次 | 内容 | 产出物 |
|------|------|--------|
| 第1周 | P0 - 创建4个 Agent 的 SOUL 文件 | `SOUL-*.md` (4个) |
| 第2周 | P1 - 编写 HUMAN-IN-LOOP.md | `HUMAN-IN-LOOP.md` |
| 第3周 | P2 - 设计顾问模式并试点 | `ADVISORY-MODE.md` |
| 第4周 | P3 - 补充缺失的 IDENTITY.md | `IDENTITY.md` (3个) |
| 第5周 | 整体测试与迭代 | - |

---

## 六、总结

本方案的核心思路：

1. **先人格后能力** - 先让每个 Agent 知道自己"是谁"，再扩展能力
2. **先安全后效率** - 先明确人机边界，再追求自动化
3. **先咨询后执行** - 顾问模式让系统能处理更广泛的任务类型
4. **边做边学** - 用迭代而非一次性到位的思路推进

方案已完成，可直接开始执行。

---

*本方案由研究员 (yanjiuyuan) 制定*
*如需调整，请联系包工头 (baogongtou)*
